<!DOCTYPE html>
<html>
<head>
    <title>PixiJS Hex Grid Test</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: Arial, sans-serif; 
            background: #222; 
            overflow: hidden;
        }
        #debug { 
            position: fixed; 
            top: 10px; 
            left: 10px; 
            background: rgba(0,0,0,0.8); 
            color: white; 
            padding: 10px; 
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }
        #gameCanvas {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div id="debug">
        <div>Mouse: <span id="mouse">0, 0</span></div>
        <div>Hover: <span id="hover">NO</span></div>
        <div>Hex: <span id="hexinfo">-</span></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.3.2/dist/pixi.min.js"></script>
    <script>
        // Wait for PIXI to load
        if (typeof PIXI === 'undefined') {
            document.body.innerHTML = '<h1 style="color:red;text-align:center;margin-top:200px;">Failed to load PixiJS library</h1>';
            throw new Error('PixiJS failed to load');
        }
        
        console.log('PixiJS loaded successfully:', PIXI.VERSION);
        
        // Hex grid constants
        const HEX_SIZE = 30;
        const HEX_WIDTH = HEX_SIZE * 2;
        const HEX_HEIGHT = Math.sqrt(3) * HEX_SIZE;
        const GRID_WIDTH = 7;
        const GRID_HEIGHT = 5;
        
        // Create PixiJS app
        const app = new PIXI.Application({
            width: 800,
            height: 600,
            backgroundColor: 0x1a1a1a,
            antialias: true
        });
        document.body.appendChild(app.view);
        
        // Container for all hexagons
        const hexContainer = new PIXI.Container();
        app.stage.addChild(hexContainer);
        
        // Center the grid
        hexContainer.x = app.screen.width / 2 - (GRID_WIDTH * HEX_WIDTH * 0.75) / 2;
        hexContainer.y = app.screen.height / 2 - (GRID_HEIGHT * HEX_HEIGHT) / 2;
        
        // Array to store hex objects
        const hexGrid = [];
        
        // Function to create a hexagon shape
        function createHexagon(color = 0x444444, glowColor = 0xffff00) {
            const graphics = new PIXI.Graphics();
            
            // Draw hexagon
            graphics.beginFill(color);
            graphics.lineStyle(2, 0x666666);
            graphics.moveTo(HEX_SIZE, 0);
            
            for (let i = 1; i <= 6; i++) {
                const angle = (i * Math.PI) / 3;
                graphics.lineTo(HEX_SIZE * Math.cos(angle), HEX_SIZE * Math.sin(angle));
            }
            
            graphics.endFill();
            return graphics;
        }
        
        // Function to convert grid coordinates to pixel coordinates
        function gridToPixel(col, row) {
            const x = col * HEX_WIDTH * 0.75;
            const y = row * HEX_HEIGHT + (col % 2) * (HEX_HEIGHT / 2);
            return { x, y };
        }
        
        // Function to convert pixel coordinates to grid coordinates
        function pixelToGrid(x, y) {
            // Adjust for container offset
            const localX = x - hexContainer.x;
            const localY = y - hexContainer.y;
            
            // Approximate grid position
            const col = Math.round(localX / (HEX_WIDTH * 0.75));
            const row = Math.round((localY - (col % 2) * (HEX_HEIGHT / 2)) / HEX_HEIGHT);
            
            return { col, row };
        }
        
        // Create the hex grid
        for (let col = 0; col < GRID_WIDTH; col++) {
            hexGrid[col] = [];
            for (let row = 0; row < GRID_HEIGHT; row++) {
                const hex = createHexagon();
                const pos = gridToPixel(col, row);
                
                hex.x = pos.x;
                hex.y = pos.y;
                hex.interactive = true;
                hex.buttonMode = true;
                
                // Store grid coordinates
                hex.gridCol = col;
                hex.gridRow = row;
                hex.isGlowing = false;
                
                // Add hover events
                hex.on('pointerover', () => {
                    if (!hex.isGlowing) {
                        hex.clear();
                        hex.beginFill(0xffff00);
                        hex.lineStyle(3, 0xffaa00);
                        hex.moveTo(HEX_SIZE, 0);
                        for (let i = 1; i <= 6; i++) {
                            const angle = (i * Math.PI) / 3;
                            hex.lineTo(HEX_SIZE * Math.cos(angle), HEX_SIZE * Math.sin(angle));
                        }
                        hex.endFill();
                        hex.isGlowing = true;
                        
                        document.getElementById('hover').textContent = 'YES';
                        document.getElementById('hover').style.color = '#0f0';
                        document.getElementById('hexinfo').textContent = `Col:${col} Row:${row}`;
                    }
                });
                
                hex.on('pointerout', () => {
                    if (hex.isGlowing) {
                        hex.clear();
                        hex.beginFill(0x444444);
                        hex.lineStyle(2, 0x666666);
                        hex.moveTo(HEX_SIZE, 0);
                        for (let i = 1; i <= 6; i++) {
                            const angle = (i * Math.PI) / 3;
                            hex.lineTo(HEX_SIZE * Math.cos(angle), HEX_SIZE * Math.sin(angle));
                        }
                        hex.endFill();
                        hex.isGlowing = false;
                        
                        document.getElementById('hover').textContent = 'NO';
                        document.getElementById('hover').style.color = '#f00';
                        document.getElementById('hexinfo').textContent = '-';
                    }
                });
                
                hex.on('pointerdown', () => {
                    console.log(`Clicked hex at ${col}, ${row}`);
                });
                
                hexContainer.addChild(hex);
                hexGrid[col][row] = hex;
            }
        }
        
        // Mouse position tracking
        app.stage.interactive = true;
        app.stage.on('pointermove', (event) => {
            const pos = event.data.global;
            document.getElementById('mouse').textContent = `${Math.round(pos.x)}, ${Math.round(pos.y)}`;
        });
        
        console.log('PixiJS Hex Grid initialized!');
        console.log(`Grid: ${GRID_WIDTH}x${GRID_HEIGHT}, Hex size: ${HEX_SIZE}`);
    </script>
</body>
</html>


